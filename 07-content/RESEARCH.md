# Lichess Content Features Research

## Overview

This document covers research findings on Lichess's content features including the Opening Explorer, Tablebase integration, Lichess TV, and Broadcasts/Relays system.

---

## Opening Explorer

### Architecture and Implementation

The Opening Explorer is powered by [lila-openingexplorer](https://github.com/lichess-org/lila-openingexplorer), a Rust-based system designed to handle "trillions of positions" across all chess variants.

**Technology Stack:**
- Written in Rust using RocksDB for data storage
- Supports direct PGN file imports (including compressed `.pgn.zst` files)
- Produces databases "well below 3x the compressed PGN size"

**Performance (February 2023):**
- Handles approximately 12,000 requests/minute
- Uses 4 RAID10 disks, 128GB RAM (100GB block cache)
- Maintains "around 100 KiB/s" compressed indexing speed during live operation

### Three Database Tabs

#### 1. Masters Database
- Contains over 2 million OTB (over-the-board) games
- Games from players rated 2200+ FIDE
- Time span: 1952 to present (updated periodically)
- Originally provided by Tony Rottella when the explorer was introduced in 2016
- Access: Analysis board > Opening Explorer settings > Set database to "Masters"

#### 2. Lichess Database
- Statistics from games played on Lichess
- Filterable by:
  - **Time controls**: Bullet, Blitz, Rapid, Classical, Correspondence
  - **Rating ranges**: Games grouped by average rating of both players (e.g., 1600, 2000-2200, 2500+)
  - **Game modes**: Rated, Casual
- Shows moves most commonly played at specific rating levels
- Useful for understanding what moves you will actually face at your level

#### 3. Player Database
- On-demand player-specific game analysis
- Search by Lichess username
- Filter by color (white/black)
- Great for opponent research or self-analysis

### How Data is Aggregated

**Statistics Calculation:**
- Win rates calculated as: `% Win + 0.5 * % Draw`
- Games grouped by *average* rating of both players
- Data stored in position->moves format with White/Draw/Black statistics

**Opening Classification:**
- Games classified by playing moves backwards until a named position is found
- Multiple entries added for common transpositions
- Opening names sourced from [lichess-org/chess-openings](https://github.com/lichess-org/chess-openings) repository

**Known Limitations:**
- Rating grouping methodology can overstate differences in win rates among opening moves
- Average rating grouping may not accurately reflect individual player experience

### API Endpoints

Base URL: `explorer.lichess.ovh`

| Endpoint | Description |
|----------|-------------|
| `/masters` | Master game statistics |
| `/lichess` | Lichess community game data |
| `/player` | Individual player games |

**Example Query:**
```bash
curl https://explorer.lichess.ovh/player?player=foo&color=white&play=e2e4
```

**Key Parameters:**
- `variant`: chess, chess960, antichess, atomic, crazyhouse, horde, kingOfTheHill, racingKings, threeCheck
- `fen`: FEN of root position
- `play`: Comma-separated moves in UCI notation
- `player`: Username (required for player endpoint)
- `color`: white or black
- `modes`: rated, casual
- `speeds`: Bullet, blitz, rapid, classical, correspondence
- `ratings`: Rating ranges (e.g., 2200, 2500)

Response format: Streamed NDJSON with move statistics including win counts, draws, and opponent ratings.

---

## Tablebase Integration

### Overview

Lichess integrates Syzygy endgame tablebases, providing perfect play analysis for positions with up to 7 pieces.

### Syzygy Tablebase Technology

**History:**
- Original 6-piece tables developed by Ronald de Man (released April 2013)
- 7-piece tables generated by Bojun Guo (May-August 2018)
- 7-piece tables contain 423,836,835,667,331 unique legal positions

**Size:**
- 7-piece tables: approximately 18.4 TB (reduced from theoretical 140 TB through optimization)
- Original 7-man size was compressed from 140 TB to 18.4 TB through efficient encoding

**Table Format:**
- **WDL (Win/Draw/Loss)**: Smaller tables accounting for 50-move rule, designed for SSD access during search
- **DTZ (Distance to Zero)**: Larger tables showing distance to zeroing the 50-move counter, used at root positions

### Lichess Implementation

The tablebase server is [lila-tablebase](https://github.com/lichess-org/lila-tablebase), built on [shakmaty-syzygy](https://crates.io/crates/shakmaty-syzygy).

**Supported Variants:**
- Standard chess
- Atomic chess
- Antichess

### API Endpoints

Base URL: `tablebase.lichess.ovh`

| Endpoint | Description |
|----------|-------------|
| `GET /standard?fen=` | Full analysis with DTM, DTZ, legal moves |
| `GET /standard/mainline?fen=` | DTZ mainline (claims draw via 50-move rule) |
| `GET /atomic?fen=` | Atomic chess positions |
| `GET /antichess?fen=` | Antichess positions |

**Example Query:**
```bash
curl http://tablebase.lichess.ovh/standard?fen=4k3/6KP/8/8/8/8/7p/8_w_-_-_0_1
```

Note: FEN positions can use underscores instead of spaces.

**Response Categories:**
| Category | Meaning |
|----------|---------|
| `win` | Winning position |
| `loss` | Losing position |
| `draw` | Drawn position |
| `cursed-win` | Would win but 50-move rule prevents |
| `blessed-loss` | Would lose but 50-move rule saves |
| `maybe-win` | Exact result unknown due to DTZ rounding |
| `maybe-loss` | Exact result unknown due to DTZ rounding |
| `unknown` | Position not in tablebase |

**Response Fields:**
- `dtz`: Distance to zero ply (50-move counter reset)
- `dtm`: Distance to mate (if available)
- `category`: Position evaluation
- `moves`: Array of legal moves with UCI and SAN notation plus evaluation

**Error Handling:**
- 404: Position not in tablebase or required tables not present

### Performance Characteristics

- Average UI request issues 23 WDL probes and 70 DTZ probes
- Rate limiting applies to prevent server overload
- Disk I/O is the primary bottleneck

---

## Lichess TV

### Overview

Lichess TV displays live games from the site, automatically selecting the "best" games to showcase across different categories.

### Channel Structure

Lichess TV is organized into channels by:
- **Time controls**: Bullet, Blitz, Rapid, Classical, Correspondence
- **Variants**: Chess960, Crazyhouse, Atomic, Horde, King of the Hill, Racing Kings, Three-Check, Antichess

Each channel displays the highest-rated game currently being played in that category.

Access: `lichess.org/tv` or `lichess.org/tv/{channel}`

### Featured Game Selection Algorithm

The selection algorithm is implemented in `Featured.scala` within the Lichess codebase.

**Primary Factors:**
1. **Average ELO rating** of both players (highest priority)
2. **Clock/time control** settings
3. **Game recency** - newly started games receive slight preference

**Algorithm Behavior:**
- The algorithm "does its best to remain on the same game"
- Will switch only if "the rating diff is huge" compared to current featured game
- Attempts to follow rematches when possible
- Adds approximately 5-second delay when switching between games

**Tips for Getting Featured:**
- Playing in unusual time zones (fewer high-rated players online)
- Playing less popular variants (Racing Kings, Atomic, etc.)
- Being among the highest-rated players actively playing

### Tournament Featured Games

For tournaments, the selection uses:
- `RankedPairing` to rank ongoing pairings
- `bestRank.value` comparison to determine featured game
- Switches when candidate has better rank than current featured game

### Time on TV Statistic

Users can see their "Time on TV" statistic on their profile, showing cumulative time their games have been featured.

### API Access

The TV API endpoint is available at `/api/tv/channels` (moved from `/tv/channels` to support CORS).

**Features:**
- Stream current TV games
- Embed TV on external websites
- Channel-specific filtering

---

## Broadcasts and Relays

### Overview

Lichess Broadcasts enable live streaming of over-the-board (OTB) chess events to thousands of online viewers. They function as specialized Lichess studies that auto-update from PGN sources.

### How Broadcasts Work

**Core Concept:**
- A broadcast is essentially a Lichess study that can live-update from a PGN file
- Games are displayed move-by-move as they unfold
- Connects to live-updating PGN files from electronic boards or other sources

**Connection Timing:**
- Automatically connects to source 1 hour before scheduled start
- Disconnects 3 hours after last received update
- Optional delay up to 60 minutes

### Setting Up a Broadcast

**Tournament-Level Settings:**
- Tournament name and location
- Time control and format
- Official website and standings links
- Time zone (auto-converts for viewers)
- FIDE rating category
- Player scoring and rating changes options

**Round-Level Settings:**
- Round name and start time
- Game source configuration
- Optional broadcast delay
- Custom scoring rules

**Limits:**
- Maximum 100 games per round
- Requires valid chess moves and player names

### Game Source Options

1. **Lichess Broadcaster App** (Recommended)
   - Cross-platform desktop application
   - Monitors local PGN folder for changes
   - Uploads via Lichess API in real-time
   - Works with LiveChessCloud links

2. **Single PGN URL**
   - Publicly hosted PGN file
   - Lichess periodically fetches for updates

3. **Multiple PGN URLs**
   - Combine several sources into one round

4. **LiveChessCloud**
   - Integration with DGT electronic boards
   - Requires adding `/[RoundNumber]` to link
   - Note: LiveChessCloud support being deprecated in favor of Broadcaster App

5. **Lichess Games**
   - By game ID or username

### DGT Board Integration

**Setup Requirements:**
- DGT LiveChess software to manage boards
- Enable "Combine PGNs per round" setting (not default)
- LiveChess 2.2 for websocket connection

**Workflow:**
1. DGT boards write PGN to folder
2. Broadcaster App monitors folder
3. App uploads moves via Lichess API
4. Viewers see moves in real-time

### Official Broadcasts

Lichess may grant "official" status to broadcasts, which provides:
- Listing on the main Broadcasts page
- More frequent update polling
- Active support from Lichess team

Contact: broadcast@lichess.org

### Broadcast API

**Available Features:**
- Real-time PGN files for rounds/tournaments
- Embed codes for external websites
- Streaming API for faster updates
- Multiple URL formats (tournament, round, group)

**Importing Individual OTB Games:**
- For non-live imports: `lichess.org/paste`
- Paste PGN for browsable replay, analysis, and shareable URL

---

## Blog System

### Overview

Lichess has a community blog system where users can publish chess-related content.

### Publishing Blogs

**Access Path:**
1. Hover over "COMMUNITY" icon
2. Select "Blog" from dropdown
3. Navigate to "My blog"
4. Click green icon to create new post

### Content Guidelines

**Required:**
- Title image for all blogs
- Author must be at least 15 years old
- Accurate tags reflecting content

**Prohibited:**
- Clickbait titles/images
- Copyrighted content without permission
- AI-generated content (discouraged)

### Embedding Content

**Games:**
- Paste game URL directly
- Supports move anchors (e.g., `#41`)
- Rendered as interactive board

**Studies:**
- Direct URL embedding supported

**Images:**
- Recommended sources: Unsplash, Creative Commons, Pixabay, Pexels, Freeimages

### Contributing to Lichess News

Opportunities include:
- Chess journalism and event coverage
- Social media and feed posts
- Written content production

---

## Sources

### Opening Explorer
- [lila-openingexplorer GitHub](https://github.com/lichess-org/lila-openingexplorer)
- [How To Use The Opening Explorer Blog](https://lichess.org/@/CheckRaiseMate/blog/how-to-use-the-opening-explorer/H4PMsjTh)
- [lichess.org open database](https://database.lichess.org/)
- [Why Opening Statistics Are Wrong](https://lichess.org/@/D2D4C2C4/blog/why-opening-statistics-are-wrong/VKNZ1oKw)
- [Lichess API Documentation](https://lichess.org/api)

### Tablebase
- [lila-tablebase GitHub](https://github.com/lichess-org/lila-tablebase)
- [Syzygy-tables.info](https://syzygy-tables.info/)
- [Optimizing the tablebase server](https://lichess.org/@/revoof/blog/optimizing-the-tablebase-server/MetV0ZQd)
- [7-piece Syzygy tablebases forum discussion](https://lichess.org/forum/general-chess-discussion/blog-W3WeMyQAACQAdfAL)
- [Syzygy Bases - Chessprogramming wiki](https://www.chessprogramming.org/Syzygy_Bases)

### Lichess TV
- [Lichess TV Forum Discussion](https://lichess.org/forum/lichess-feedback/new-feature-lichess-tv)
- [Time on TV Discussion](https://lichess.org/forum/general-chess-discussion/time-on-tv-3)
- [lila GitHub Repository](https://github.com/lichess-org/lila)

### Broadcasts
- [How to use Lichess Broadcasts](https://lichess.org/broadcast/help)
- [Lichess Broadcaster App](https://lichess.org/broadcast/app)
- [broadcaster GitHub](https://github.com/lichess-org/broadcaster)
- [Broadcast Team Page](https://lichess.org/page/broadcast-team)

### Blog System
- [Blog Tips](https://lichess.org/page/blog-tips)
- [Blog Etiquette](https://lichess.org/page/blog-etiquette)
- [Community Blogs](https://lichess.org/blog/community)
